<template>
  <div id="overlayPopup" class="overlay"  v-if="model" @click.self="closePopup">
    <div class="popup-content">
      <!-- Header -->
      <div class="popup_header">
        <span class="font-heading-1">Th√™m ·ª©ng vi√™n</span>
        <button class="icon icon-exit" @click="closePopup">ƒê√≥ng</button>
      </div>

      <!-- Form -->
      <div class="popup-form">
        <form class="form" @submit.prevent="handleSave">
                    <div class="form-detail">
                        <label>H·ªç v√† t√™n <span>*</span></label>
                        <input v-model="form.name" type="text" name="name" class="required" id="name" placeholder="Nh·∫≠p h·ªç v√† t√™n">
                    </div>
                    <div class="form-section">
                        <div class="form-detail">
                            <label>Ng√†y sinh</label>
                            <input v-model="form.birth" type="date" name="birth" id="birth">
                        </div>
                        <div class="form-detail">
                            <label>GI·ªõi t√≠nh</label>
                            <select v-model="form.gender" name="gender" id="gender">
                                <option value="" disabled selected hidden>Ch·ªçn gi·ªõi t√≠nh</option>
                                <option value="">Nam</option>
                                <option value="">N·ªØ</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-detail">
                        <label>Khu v·ª±c</label>
                        <select v-model="form.area" name="area" id="area">
                            <option value="" disabled selected hidden>Ch·ªçn khu v·ª±c</option>
                            <option value="">C·∫ßu gi·∫•y</option>
                            <option value="">T√¢y H·ªì</option>
                            <option value="">Thanh Xu√¢n</option>
                            <option value="">Gia L√¢m</option>
                            <option value="">T√¢y H·ªì</option>
                        </select>
                    </div>

                    <div class="form-section">
                        <div class="form-detail">
                            <label>S·ªë ƒëi·ªán tho·∫°i</label>
                            <input v-model="form.phone" type="text" name="phone" id="phone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
                        </div>
                        <div class="form-detail">
                            <label>Email</label>
                            <input v-model="form.email" type="email" name="email" id="email" placeholder="Nh·∫≠p Email">
                        </div>
                    </div>

                    <div class="form-detail">
                        <label>ƒê·ªãa ch·ªâ</label>
                        <input v-model="form.address" type="text" name="address" id="address" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ">
                    </div>

                    <span class="uppercase">H·ªçc v·∫•n</span>

                    <div class="form-section" style="flex-direction: column;">
                        <div class="form-detail"
                            style="flex-direction: row; align-items: center; justify-content: space-between;">
                            <label>‚Ä¢ Tr√¨nh ƒë·ªô ƒë√†o t·∫°o</label>
                            <div class="edu-select-wrapper">
                                <select v-model="form.educationDegree" style="height: 36px;" id="education-degreeName">
                                    <option value="" hidden>Nh·∫≠p tr√¨nh ƒë·ªô ƒë√†o t·∫°o</option>
                                    <option>ƒê·∫°i h·ªçc</option>
                                    <option>Cao ƒë·∫≥ng</option>
                                    <option>Th·∫°c sƒ©</option>
                                    <option>Ti·∫øn sƒ©</option>
                                </select>
                                <span class="icon-plus">+</span>
                            </div>
                        </div>


                        <div class="form-detail "
                            style="flex-direction: row; align-items: center; justify-content: space-between;">
                            <label >‚Ä¢ N∆°i ƒë√†o t·∫°o</label>
                            <div class="edu-select-wrapper">
                                <select v-model="form.educationPlace" id="education-placeName">
                                    <option value="" hidden>Nh·∫≠p n∆°i ƒë√†o t·∫°o</option>
                                    <option>HUST</option>
                                    <option>NEU</option>
                                    <option>KTA</option>
                                    <option>PTIT</option>
                                </select>
                                <span class="icon-plus">+</span>
                            </div>
                        </div>


                        <div class="form-detail"
                            style="flex-direction: row; align-items: center; justify-content: space-between;">
                            <label>‚Ä¢ Chuy√™n ng√†nh</label>
                            <div class="edu-select-wrapper" >
                                <select v-model="form.educationMajor" id="education-majorName">
                                    <option value="" hidden>Nh·∫≠p chuy√™n ng√†nh</option>
                                    <option>K·∫ø to√°n</option>
                                    <option>Marketing</option>
                                    <option>Grab</option>
                                </select>
                                <span class="icon-plus">+</span>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <button class=" btn btn-primary btn-icon btn-form">
                        <div class="icon icon-plus"></div>
                        <span>Th√™m h·ªçc v·∫•n</span>
                    </button>

                    <div class="form-section">
                        <div class="form-detail">
                            <label>Ng√†y ·ª©ng tuy·ªÉn</label>
                            <input v-model="form.dateApply" type="date" name="date-apply" id="date-apply">
                        </div>
                        <div class="form-detail">
                            <label>Ngu·ªìn ·ª©ng vi√™n</label>
                            <select v-model="form.source" name="candidate-source" id="candidate-source">
                                <option value="" disabled selected hidden>Ch·ªçn ngu·ªìn ·ª©ng vi√™n</option>
                                <option value="">Facebook</option>
                                <option value="">Joko</option>
                            </select>
                        </div>
                    </div>


                    <div class="form-section">
                        <div class="form-detail">
                            <label>Nh√¢n s·ª± khai th√°c</label>
                            <select name="personnel" id="personnel">
                                <option value="" selected>ƒêinh Nga</option>
                                <option value="">Fads</option>
                            </select>
                        </div>
                        <div class="form-detail">
                            <label>C·ªông t√°c vi√™n</label>
                            <select name="collaborator" id="collaborator">
                                <option value="" disabled selected hidden>Ch·ªçn c·ªông t√°c vi√™n</option>
                                <option value="">@@@@@@</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-detail" style="flex-direction: row; align-items: center; gap: 16px;">
                        <input type="checkbox">
                        <span>Th√™m nhanh ng∆∞·ªùi tham chi·∫øu v√†o kho ·ª©ng vi√™n</span>
                    </div>


                    <button class=" btn btn-primary btn-icon btn-form">
                        <div class="icon icon-plus"></div>
                        <span>Th√™m ng∆∞·ªùi gi·ªõi thi·ªáu</span>
                    </button>

                    <div class="form-detail">
                        <label >N∆°i l√†m vi·ªác g·∫ßn ƒë√¢y</label>
                        <input v-model="form.placeRecent" type="text" name="place-recent" id="place-recent"
                            placeholder="Nh·∫≠p n∆°i l√†m vi·ªác g·∫ßn ƒë√¢y">
                    </div>

                    <hr>

                    <button class=" btn btn-primary btn-icon btn-form">
                        <div class="icon icon-plus"></div>
                        <span>Th√™m kinh nghi·ªám l√†m vi·ªác</span>
                    </button>

                    <div class="form-detail">
                        <label>N∆°i l√†m vi·ªác</label>
                        <input type="text" name="place-present" id="place-present" placeholder="Nh·∫≠p n∆°i l√†m vi·ªác">
                    </div>

                    <div class="form-section">
                        <div class="form-detail">
                            <label>Th·ªùi gian </label>
                            <div class="form-time">
                                <input type="date" name="date-start" id="date-start">
                                <span>-</span>
                                <input type="date" name="date-end" id="date-end">
                            </div>
                        </div>
                    </div>

                    <div class="form-detail">
                        <label>V·ªã tr√≠ c√¥ng vi·ªác</label>
                        <input type="text" name="possition-recent" id="possition-recent" placeholder="Nh·∫≠p v·ªã tr√≠ c√¥ng vi·ªác">
                    </div>

                    <div class="form-detail">
                        <label>M√¥ t·∫£ c√¥ng vi·ªác</label>
                        <textarea name="work-des" id="work-des" placeholder="Nh·∫≠p m√¥ t·∫£ c√¥ng vi·ªác" rows="5"></textarea>
                    </div>



                </form>
      </div>

      <!-- Footer -->
      <div class="popup-footer">
        <button class="btn" @click="closePopup">H·ªßy</button>
        <button class="btn btn-primary" @click="handleSave">L∆∞u</button>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, defineModel, defineEmits } from 'vue'

const model = defineModel('open', { type: Boolean, required: true })
const emit = defineEmits(['save']) // üß© th√™m d√≤ng n√†y

const form = ref({
  name: '',
  birth: '',
  gender: '',
  area: '',
  phone: '',
  email: '',
  address: '',
  educationDegree: '',
  educationPlace: '',
  educationMajor: '',
  dateApply: '',
  source: '',
  personnel: '',
  collaborator: '',
  placeRecent: '',
  positionRecent: '',
  workDesc: ''
})

const closePopup = () => {
  model.value = false
}

const handleSave = () => {
  try {
    const newCandidate = {
      id: Date.now(),
      ...form.value
    }

    // üîπ G·ª≠i d·ªØ li·ªáu l√™n component cha
    emit('save', newCandidate)

    // C≈©ng c√≥ th·ªÉ l∆∞u localStorage t·∫°i ƒë√¢y n·∫øu b·∫°n mu·ªën song song
    const existing = JSON.parse(localStorage.getItem('candidates') || '[]')
    existing.push(newCandidate)
    localStorage.setItem('candidates', JSON.stringify(existing))

    alert('ƒê√£ l∆∞u ·ª©ng vi√™n (k·ªÉ c·∫£ d·ªØ li·ªáu tr·ªëng).')

    Object.keys(form.value).forEach(key => (form.value[key] = ''))
    closePopup()
  } catch (err) {
    console.error('L·ªói khi l∆∞u localStorage:', err)
    alert('C√≥ l·ªói khi l∆∞u ·ª©ng vi√™n!')
  }
}
</script>

<style scoped>
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.4);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.popup-content {
  width: 560px;
  height: calc(100vh - 32px);
  background-color: #fff;
  border-radius: 8px;
  overflow-y: auto;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  display: flex;
  flex-direction: column;

}

.popup_header {
  padding: 16px 24px;
  display: flex;
  justify-content: space-between;

}

.popup-form {
  padding: 48px;
  background-color: none;
  flex: 1;
  overflow: auto;
}

.popup-footer {
  height: 56px;
  background-color: #F1F2F5;
  padding: 9px 24px;
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 8px;
}

.form {
  background-color: none;
  display: flex;
  flex-direction: column;
  gap: 16px;
  ;
}

.form-section {
  display: flex;
  justify-content: space-between;
  gap: 15px;
}

.popup-form .form-detail {
  flex: 1;
  display: flex;
  flex-direction: column;

}

.popup-form .form-detail input,
.popup-form .form-detail select {
  height: 32px;
  border-radius: 4px;
  border: 1px solid #ccc;
  padding: 0 16px;
}

.popup-form label,
.popup-form span {
  font-size: 14px;
  font-weight: 500;
}


.edu-select-wrapper select {
  width: 287px ;
}

.form-detail .form-time{
   display: flex;
   justify-content: space-between;
   align-items: center;
}

.form-detail .form-time input{
  width: 200px;
}

.form-detail textarea {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid var(--color-border-primary);
  border-radius: 4px;
  font-size: 14px;
  resize: vertical;
  font-family: inherit;
}

.form-detail textarea:focus {
  border-color: #007bff;
  outline: none;
}

.overlay {
  animation: fadeIn 0.3s ease;
}

.popup-content {
  animation: slideUp 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</style>
